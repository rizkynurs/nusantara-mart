apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: report-aggregator-vs
  namespace: retail
spec:
  hosts: ["report-aggregator.api.nusmart.id"]
  gateways: ["istio-system/public-gw"]
  http:
    - route:
        - destination: { host: report-aggregator, subset: stable }
          weight: 100
        - destination: { host: report-aggregator, subset: canary }
          weight: 0
      retries: { attempts: 3, perTryTimeout: 1s, retryOn: 5xx,connect-failure,reset,refused-stream }
      timeout: 5s
