apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: notifications-dr
  namespace: retail
spec:
  host: notifications
  trafficPolicy:
    tls: { mode: ISTIO_MUTUAL }
    outlierDetection: { consecutive5xxErrors: 5, interval: 5s, baseEjectionTime: 30s }
  subsets:
    - name: stable
      labels: { app: notifications }
    - name: canary
      labels: { rollouts-pod-template-hash: canary }
